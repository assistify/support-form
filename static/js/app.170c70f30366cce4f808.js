webpackJsonp([1],{"2Gar":function(e,t){},"9M+g":function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),o={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return"Login"!=e.$route.name?r("b-navbar",{attrs:{variant:"dark",type:"dark"}},[r("b-navbar-brand",{attrs:{href:"#"}},[r("img",{attrs:{src:n("tWCk"),width:"50",height:"50",alt:"assistify"}}),e._v("\n    Assistify Support\n  ")]),e._v(" "),r("b-navbar-nav",{staticClass:"ml-left"},[r("b-nav-item",{directives:[{name:"show",rawName:"v-show",value:e.config,expression:"config"}]},[r("b-nav-item",{attrs:{href:"#"},on:{click:e.onConfigure}},[e._v("Configure")])],1)],1),e._v(" "),r("b-navbar-nav",{staticClass:"ml-auto"},[r("b-nav-item",{attrs:{right:""}},[r("b-button",{attrs:{variant:"danger"},on:{click:this.$parent.onLogout}},[e._v("Logout")])],1)],1)],1):e._e()},staticRenderFns:[]},s=n("VU/8")({name:"Navbar",data:function(){return{config:this.showConfigure()}},methods:{onConfigure:function(){this.$router.push({name:"Configure"})},showConfigure:function(){return this.$parent.config.admin||!1}}},o,!1,null,null,null).exports,a=n("7t+N"),i=n.n(a);var u={name:"App",components:{Navbar:s},created:function(){this.config={server:this.$cookies.get("server"),authToken:this.$cookies.get("authToken"),userId:this.$cookies.get("userId")};var e=function(e,t){if(e.server)return i.a.ajax({url:e.server.concat("/api/v1/me"),method:"GET",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},async:!1}).responseJSON}(this.config);e&&"error"!==e.status?(this.setMyInfo(e),this.$router.push({name:"Support"})):console.log("No session found")},methods:{makeToast:function(e){this.$bvToast.toast(e.text,{title:e.title,autoHideDelay:5e3,variant:e.variant||null,toaster:e.toaster||"b-toaster-top-right",solid:!0})},setMyInfo:function(e){this.config.email=e.email,this.config.name=e.name,this.config.admin=e.roles.includes("config-expert")},doLogin:function(e,t,n,r){this.$cookies.set("server",this.config.server=e),this.$cookies.set("authToken",this.config.authToken=t),this.$cookies.set("userId",this.config.userId=n),this.setMyInfo(r),this.$router.push({name:"Support"})},onLogout:function(e){var t,n,r=this;e.preventDefault(),t=this.config,n=function(){r.$router.push({name:"Login"})},i.a.ajax({url:t.server.concat("/api/v1/logout"),method:"POST",headers:{"X-Auth-Token":t.authToken,"X-User-Id":t.userId}}).done(function(e){n(e)}).fail(function(e){n(null,e)}),this.$cookies.set("server",null),this.$cookies.set("authToken",null),this.$cookies.set("userId",null)}}},l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("Navbar"),this._v(" "),t("div",{attrs:{id:"app"}},[t("router-view")],1)],1)},staticRenderFns:[]};var d=n("VU/8")(u,l,!1,function(e){n("xCsT")},null,null).exports,c=n("/ocq"),f={name:"Login",data:function(){return{form:{username:"",password:"",url:""},err:!1,show:!1}},methods:{onLogin:function(e){var t=this;e.preventDefault();var n,r,o={server:new URL(this.form.url).origin,user:this.form.username,password:this.form.password};n=o,r=function(e,n){n?t.$parent.makeToast({text:n.responseJSON.message,title:"Login failed",variant:"danger"}):t.$parent.doLogin(o.server,e.data.authToken,e.data.userId,e.data.me)},i.a.ajax({url:n.server.concat("/api/v1/login"),method:"POST",data:{user:n.user,password:n.password}}).done(function(e){r(e)}).fail(function(e){r(null,e)})},onClose:function(e){},onConnect:function(e){var t=this;!function(e,t){i.a.ajax({url:e+"/api/v1/info",timeout:2e3}).done(function(e){t(e)}).fail(function(e){t(null,e)})}(new URL(this.form.url).origin,function(e,n){n?t.$parent.makeToast({text:n,title:"Invalid Server URL",variant:"danger"}):t.show=!0})}}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{staticClass:"login_page"},[n("b-card",{staticClass:"mb-2",attrs:{align:"center",header:"Assistify","header-tag":"header"}},[n("b-form",{on:{submit:e.onLogin,reset:e.onClose}},[e.show?e._e():n("div",[n("b-form-row",{staticClass:"my-3",attrs:{"align-h":"center"}},[n("b-input-group",{staticClass:"mb-3",attrs:{prepend:"Server",size:""}},[n("b-form-input",{attrs:{placeholder:"Enter the URL https://.."},model:{value:e.form.url,callback:function(t){e.$set(e.form,"url",t)},expression:"form.url"}}),e._v(" "),n("b-input-group-append",[n("b-button",{attrs:{size:"sm",text:"Button",variant:"success"},on:{click:e.onConnect}},[e._v("Connect")])],1)],1)],1)],1),e._v(" "),e.show?n("div",[n("b-form-row",{staticClass:"my-3",attrs:{"align-h":"center"}},[n("b-col",[n("b-form-input",{attrs:{id:"input-username",state:null,placeholder:"Username"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),e._v(" "),n("b-form-row",{staticClass:"my-3",attrs:{"align-h":"center"}},[n("b-col",[n("b-form-input",{attrs:{id:"input-password",state:null,type:"password",placeholder:"Password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),e._v(" "),n("b-form-row",{staticClass:"my-3",attrs:{align:"center"}},[n("b-col",[n("b-button",{attrs:{block:"",type:"submit",variant:"outline-primary"}},[e._v("Login")])],1)],1),e._v(" "),n("b-form-row",{staticClass:"my-3",attrs:{"align-h":"center"}},[n("b-col",[n("b-button",{attrs:{block:"",type:"reset",variant:"light"}},[e._v("Cancel")])],1)],1)],1):e._e()])],1)],1)},staticRenderFns:[]};var p=n("VU/8")(f,h,!1,function(e){n("2Gar")},"data-v-69a08f45",null).exports,m=n("woOf"),v=n.n(m),b=null;function g(e,t,n){!function(e,t){var n=void 0;n="p"===e.channelType?e.server+"/api/v1/groups.members":e.server+"/api/v1/channels.members",i.a.ajax({url:n,dataType:"json",method:"GET",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},data:{roomId:e.channelId}}).done(function(e){t(e)}).fail(function(e){t(null,e)})}(e,function(r,o){if(o)n(null,o);else{var s=r.members.map(function(e){return e.username}),a={parentId:e.channelId,name:t.subject,members:s||[]};!function(e,t,n){i.a.ajax({url:e.server.concat("/api/v1/rooms.createDiscussion"),dataType:"json",method:"POST",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},data:{prid:t.parentId,t_name:t.name,users:t.members}}).done(function(e){n(e)}).fail(function(e){n(null,e)})}(e,a,function(e,t){t?n(null,t):n(e)})}})}function k(e,t,n){g(e,t,function(r,o){if(o)n(null,o);else{var s=e.server+"/api/v1/chat.postMessage",a=r.discussion.name;i.a.ajax({url:s,dataType:"json",method:"POST",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},data:{roomId:r.discussion._id,channel:"#"+a,text:t.description}}).done(function(t){var r;b&&(e.server.replace(/.*\/\/([^.]+).*/,"$1"),e.userId,t.message.rid,(r=document.createElement("img")).src=b,document.body.appendChild(r)),n(t)}).fail(function(e){n(null,e)})}})}function y(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.hasOwnProperty("customFields")&&e.customFields.keywords}).map(function(e){return{id:e._id,name:e.fname,type:e.t,keywords:e.customFields.keywords,isDefault:e.default}})}function w(e){var t=e.server+"/api/v1/channels.list.joined",n=e.server+"/api/v1/groups.list",r=i.a.ajax({url:t,dataType:"json",method:"GET",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},async:!1});return i.a.ajax({url:n,dataType:"json",method:"GET",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},async:!1}).responseJSON.groups.concat(r.responseJSON.channels).sort(function(e,t){return e.name.localeCompare(t.name)})}var _={name:"Support",data:function(){return{form:{subject:null,description:null},show:!0}},created:function(){if(this.$parent.config.server&&this.$parent.config.userId&&this.$parent.config.authToken){var e=w(this.$parent.config);this.keywords=y(e),this.defaultChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=y(e).find(function(e){return e.keywords.indexOf("default")>=0});if(t)return{id:t.id,type:t.t};var n=e.find(function(e){return e.default});if(n)return{id:n._id,type:n.t};var r=e.find(function(e){return e.name.match(/^general$/i)});if(r)return{id:r._id,type:r.t};throw Error("No default channel found!")}(e)}else this.$router.push({name:"Login"})},methods:{onSubmit:function(e){var t=this;e.preventDefault();var n=this.form.subject+" "+this.form.description,r=this.keywords.find(function(e){return e.keywords.some(function(e){return n.includes(e)})})||this.defaultChannel;k(v()({channelId:r.id,channelType:r.type},this.$parent.config),this.form,function(e,n){var r={size:"sm",buttonSize:"sm",headerClass:"p-2 border-bottom-0",centered:!0,footerClass:"p-2",hideHeaderClose:!1},o=void 0;n?v()(r,{title:"Failed",okVariant:"error",okTitle:"Ok",text:"Discussion cannot be created in Assistify. Please re-try later.\nDetails: "+n.responseJSON.error}):(v()(r,{title:"Success",okVariant:"success",okTitle:"YES",cancelTitle:"NO",text:"Discussion was created in Assistify. Would you like to view the discussion?"}),o=t.$parent.config.server+"/group/"+e.channel.substring(1)+"?msg="+e.message._id),t.$bvModal.msgBoxConfirm(r.text,r).then(function(e){e&&o&&window.open(o,"_blank")})})},onReset:function(e){var t=this;e.preventDefault(),this.form.subject="",this.form.description="",this.form.checked=[],this.show=!1,this.$nextTick(function(){t.show=!0})}}},T={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-container",[n("b-card",{staticClass:"mb-2",attrs:{align:"center",header:"Ask for Support","header-tag":"header"}},[e.show?n("b-form",{on:{submit:e.onSubmit,reset:e.onReset}},[n("b-form-group",{attrs:{id:"input-group-3",label:"Subject:","label-for":"input-3"}},[n("b-form-input",{attrs:{id:"input-3",required:"",placeholder:"Enter subject"},model:{value:e.form.subject,callback:function(t){e.$set(e.form,"subject",t)},expression:"form.subject"}})],1),e._v(" "),n("b-form-group",{attrs:{id:"input-group-4",label:"Description:","label-for":"input-4"}},[n("b-form-textarea",{attrs:{id:"input-3",required:"",rows:"3","max-rows":"6",placeholder:"Enter Description"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),n("b-button",{attrs:{type:"submit",variant:"outline-primary"}},[e._v("Submit")]),e._v(" "),n("b-button",{attrs:{type:"reset",variant:"outline-danger"}},[e._v("Reset")])],1):e._e()],1)],1)],1)},staticRenderFns:[]},$=n("VU/8")(_,T,!1,null,null,null).exports,C={data:function(){return{selectMode:"single",fields:[{key:"channel",label:"Channel"},{key:"keywords",label:"Keywords"},{key:"actions",label:"Actions"}],editModal:{id:"modal-edit-keywords",title:"",channelId:"",content:""}}},created:function(){var e=w(this.$parent.config);this.mappings=e.filter(function(e){return!e.prid}).map(function(e){return{id:e._id,channel:e.name,type:e.t,keywords:e.customFields&&e.customFields.hasOwnProperty("keywords")&&e.customFields.keywords.join(",")||null}})},methods:{edit:function(e,t,n){this.editModal.title="Update keywords for channel: "+e.channel,this.editModal.channelId=e.id,this.editModal.type=e.type,this.editModal.content=e.keywords,this.$bvModal.show(this.editModal.id)},save:function(e,t,n){this.$bvModal.hide(this.editModal.id);var r={id:this.editModal.channelId,type:this.editModal.type,keywords:this.editModal.content.split(",")};this.handleSave(r)},handleSave:function(e){var t=this.mappings;!function(e,t,n){var r="p"===t.type?e.server.concat("/api/v1/groups.setCustomFields"):e.server.concat("/api/v1/channels.setCustomFields");i.a.ajax({url:r,dataType:"json",method:"POST",headers:{"X-Auth-Token":e.authToken,"X-User-Id":e.userId},data:{roomId:t.id,customFields:{keywords:t.keywords}}}).done(function(e){n(e)}).fail(function(e){n(null,e)})}(this.$parent.config,e,function(e,n){if(n)alert(JSON.string(n));else{var r=e.channel&&e.channel._id||e.group&&e.group._id,o=t.findIndex(function(e){return e.id===r}),s=e.channel&&e.channel.customFields.keywords.join(",")||e.group&&e.group.customFields.keywords.join(",");t[o].keywords=s}})}}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{attrs:{fluid:""}},[n("b-table",{attrs:{bordered:"",striped:"",hover:"",items:e.mappings,fields:e.fields},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[n("b-button",{staticClass:"mr-1",attrs:{size:"sm"},on:{click:function(n){return e.edit(t.item,t.index,n.target)}}},[e._v("Edit")])]}}])}),e._v(" "),n("b-modal",{staticClass:"mt-3",attrs:{centered:"",id:e.editModal.id,title:e.editModal.title,"hide-footer":""}},[n("b-form",{ref:"saveKeyword",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSave(t)}}},[n("b-form-textarea",{attrs:{id:"keyword-textarea",rows:"4","no-resize":""},model:{value:e.editModal.content,callback:function(t){e.$set(e.editModal,"content",t)},expression:"editModal.content"}})],1),e._v(" "),n("div",{staticClass:"mt-2 float-right"},[n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"success"},on:{click:e.save}},[e._v("Save")]),e._v(" "),n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"danger"},on:{click:function(t){return e.$bvModal.hide(e.editModal.id)}}},[e._v("Cancel")])],1)],1)],1)},staticRenderFns:[]},I=n("VU/8")(C,x,!1,null,null,null).exports;r.default.use(c.a);var S=new c.a({routes:[{path:"/",name:"Login",component:p},{path:"/support",name:"Support",component:$},{path:"/config",name:"Configure",component:I}]}),j=(n("Jmt5"),n("9M+g"),n("Tqaz")),M=n("ppUw"),U=n.n(M);r.default.use(j.a),r.default.use(U.a),U.a.config("30d"),r.default.config.productionTip=!1,new r.default({el:"#app",router:S,components:{App:d},template:"<App/>"})},tWCk:function(e,t,n){e.exports=n.p+"static/img/assistify.aeacc02.png"},xCsT:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.170c70f30366cce4f808.js.map